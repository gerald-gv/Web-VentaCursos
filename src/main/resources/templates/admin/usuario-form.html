<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/admin-layout :: layout(~{::content})}">

<div th:fragment="content">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-10 max-w-3xl">

        <div class="mb-10">
            <a href="/admin/usuarios"
               class="group inline-flex items-center gap-2 text-slate-400 hover:text-emerald-400 transition-colors mb-6 text-sm font-medium">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 group-hover:-translate-x-1 transition-transform">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
                </svg>
                Volver a Usuarios
            </a>

            <h1 class="text-3xl font-extrabold text-white tracking-tight">
                <span th:text="${esNuevo ? 'Crear Nuevo Usuario' : 'Editar Usuario'}">Título</span>
            </h1>
            <p class="text-slate-500 mt-1">Configura las credenciales y el nivel de acceso del usuario.</p>
        </div>

        <form th:action="@{/admin/usuarios/guardar}"
              method="post"
              th:object="${usuario}"
              class="space-y-8">

            <input type="hidden" th:field="*{idUsuario}">

            <div class="bg-neutral-900/50 border border-slate-800 rounded-2xl p-8 shadow-sm">
                <div class="flex items-center gap-3 mb-8 border-b border-slate-800/50 pb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-emerald-500">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-3.833-6.247 4.125 4.125 0 0 0-3.833 6.247ZM3.076 19.128a9.135 9.135 0 0 1 3.076-1.334 9.135 9.135 0 0 1 3.076 1.334 4.125 4.125 0 0 1-3.833 6.247 4.125 4.125 0 0 1-3.833-6.247ZM12 12a4.5 4.5 0 1 0 0-9 4.5 4.5 0 0 0 0 9Z" />
                    </svg>
                    <h2 class="text-lg font-bold text-white uppercase tracking-wider">Información de Cuenta</h2>
                </div>

                <div class="space-y-6">
                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">Nombre Completo *</label>
                        <input type="text" th:field="*{nombre}" required
                               class="w-full bg-neutral-800 border border-slate-700 rounded-xl px-4 py-3 text-white focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all"
                               placeholder="Ej: Juan Pérez">
                    </div>

                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">Correo Electrónico *</label>
                        <input type="email" th:field="*{email}" required
                               class="w-full bg-neutral-800 border border-slate-700 rounded-xl px-4 py-3 text-white focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all"
                               placeholder="ejemplo@correo.com">

                        <div class="mt-2 flex items-center gap-2">
                            <svg th:if="${!esNuevo}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-amber-500">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0Zm-8-5a.75.75 0 0 1 .75.75v4.5a.75.75 0 0 1-1.5 0v-4.5A.75.75 0 0 1 10 5Zm0 10a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z" clip-rule="evenodd" />
                            </svg>
                            <p class="text-[11px] italic"
                               th:classappend="${esNuevo ? 'text-slate-500' : 'text-amber-500'}"
                               th:text="${esNuevo ? 'Se usará para el acceso a la plataforma.' : 'Modificar el correo afectará las credenciales de acceso.'}">
                                Info
                            </p>
                        </div>
                    </div>

                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">
                            Contraseña
                            <span th:if="${!esNuevo}" class="text-slate-500 lowercase font-normal">(dejar en blanco para mantener actual)</span>
                        </label>
                        <input type="password" th:field="*{contrasenia}" th:required="${esNuevo}"
                               class="w-full bg-neutral-800 border border-slate-700 rounded-xl px-4 py-3 text-white focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all"
                               placeholder="Mínimo 6 caracteres" minlength="6">
                    </div>

                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">Estado de Cuenta</label>
                        <select th:field="*{activo}"
                                class="w-full bg-neutral-800 border border-slate-700 rounded-xl px-4 py-3 text-white focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all cursor-pointer">
                            <option th:value="true">Activo / Con Acceso</option>
                            <option th:value="false">Inactivo / Bloqueado</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="bg-neutral-900/50 border border-slate-800 rounded-2xl p-8">
                <div class="flex items-center gap-3 mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-emerald-500">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" />
                    </svg>
                    <h2 class="text-lg font-bold text-white uppercase tracking-wider">Roles y Permisos</h2>
                </div>

                <div class="mb-6 p-4 rounded-xl bg-amber-500/5 border border-amber-500/10 flex items-start gap-3" th:unless="${esNuevo}">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-amber-500 mt-0.5">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0Zm-8-5a.75.75 0 0 1 .75.75v4.5a.75.75 0 0 1-1.5 0v-4.5A.75.75 0 0 1 10 5Zm0 10a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z" clip-rule="evenodd" />
                    </svg>
                    <p class="text-xs text-amber-200/70 leading-relaxed">
                        Por razones de integridad en el historial de transacciones, los roles no son editables una vez creado el usuario.
                    </p>
                </div>

                <div class="pb-4 grid grid-cols-1 md:grid-cols-2 gap-4 items-stretch">
                    <div class="relative h-full">
                        <input type="radio" name="roles" value="ROLE_CLIENTE" id="rol_cliente"
                               th:checked="${usuario.roles.contains('ROLE_CLIENTE')}"
                               th:disabled="${!esNuevo}"
                               class="peer hidden">
                        <label for="rol_cliente"
                               class="flex flex-col h-full p-6 bg-neutral-800 border-2 border-slate-700 rounded-2xl cursor-pointer transition-all duration-300
                      peer-checked:border-blue-500 peer-checked:bg-blue-500/5
                      peer-disabled:opacity-40 peer-disabled:cursor-not-allowed
                      hover:border-slate-500 peer-checked:hover:border-blue-400">
                            <span class="text-[10px] font-extrabold uppercase tracking-widest text-blue-400 mb-2">Perfil estándar</span>
                            <h3 class="text-white font-bold text-lg">Cliente</h3>
                            <p class="text-slate-500 text-xs mt-2 leading-relaxed">Acceso a la tienda, mis cursos y perfil personal de estudiante.</p>

                            <div class="absolute top-4 right-4 text-blue-500 opacity-0 peer-checked:opacity-100 transition-opacity">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z" clip-rule="evenodd" />
                                </svg>
                            </div>
                        </label>
                    </div>

                    <div class="relative h-full">
                        <input type="radio" name="roles" value="ROLE_ADMIN" id="rol_admin"
                               th:checked="${usuario.roles.contains('ROLE_ADMIN')}"
                               th:disabled="${!esNuevo}"
                               class="peer hidden">
                        <label for="rol_admin"
                               class="flex flex-col h-full p-6 bg-neutral-800 border-2 border-slate-700 rounded-2xl cursor-pointer transition-all duration-300
                      peer-checked:border-amber-500 peer-checked:bg-amber-500/5
                      peer-disabled:opacity-40 peer-disabled:cursor-not-allowed
                      hover:border-slate-500 peer-checked:hover:border-amber-400">
                            <span class="text-[10px] font-extrabold uppercase tracking-widest text-amber-400 mb-2">Perfil Staff</span>
                            <h3 class="text-white font-bold text-lg">Administrador</h3>
                            <p class="text-slate-500 text-xs mt-2 leading-relaxed">Acceso total al panel de gestión, edición de cursos y reportes financieros.</p>

                            <div class="absolute top-4 right-4 text-amber-500 opacity-0 peer-checked:opacity-100 transition-opacity">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z" clip-rule="evenodd" />
                                </svg>
                            </div>
                        </label>
                    </div>
                </div>

            <div class="flex flex-col sm:flex-row items-center justify-end gap-4 pt-6 border-t border-slate-800">
                <a href="/admin/usuarios"
                   class="w-full sm:w-auto text-center px-8 py-3 text-slate-400 hover:text-white transition-colors font-semibold">
                    Cancelar
                </a>
                <button type="submit"
                        class="w-full sm:w-auto bg-emerald-600 hover:bg-emerald-500 text-white px-10 py-4 rounded-xl font-bold transition-all shadow-lg shadow-emerald-900/40 active:scale-95">
                    Guardar Cambios
                </button>
            </div>
        </form>
    </div>
</div>
</html>